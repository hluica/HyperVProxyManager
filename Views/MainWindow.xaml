<ui:FluentWindow
    x:Class="HyperVProxyManager.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:HyperVProxyManager.ViewModels"
    Title="虚拟机代理控制"
    Width="720"
    Height="460"
    ExtendsContentIntoTitleBar="True"
    ResizeMode="CanMinimize"
    WindowBackdropType="Mica"
    WindowStartupLocation="CenterScreen">

    <ui:FluentWindow.InputBindings>
        <KeyBinding
            Key="F5"
            Command="{Binding LoadedCommand}" />
    </ui:FluentWindow.InputBindings>

    <behaviors:Interaction.Triggers>
        <behaviors:EventTrigger EventName="Loaded">
            <behaviors:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </behaviors:EventTrigger>
    </behaviors:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <!--  0: TitleBar  -->
            <RowDefinition Height="Auto" />
            <!--  1: Content  -->
            <RowDefinition Height="*" />
            <!--  2: StatusBar  -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  标题栏  -->
        <ui:TitleBar
            Title="Hyper-V Proxy Manager"
            Grid.Row="0" />

        <!--  主内容区域  -->
        <Grid
            Grid.Row="1"
            Margin="24">
            <Grid.RowDefinitions>
                <!--  0: Info Cards  -->
                <RowDefinition Height="Auto" />
                <!--  1: Spacer (Vertical)  -->
                <RowDefinition Height="24" />
                <!--  2: Action Buttons  -->
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  定义统一的列结构：左右各占一半，中间留出统一的 16px 间隙  -->
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  ===第一行：信息卡片 (Row 0)===  -->
            <!--  左侧：宿主机信息卡片  -->
            <ui:Card
                Grid.Row="0"
                Grid.Column="0"
                VerticalAlignment="Stretch">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <ui:SymbolIcon
                        Grid.Row="0"
                        HorizontalAlignment="Left"
                        FontSize="24"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Symbol="Desktop24" />

                    <TextBlock
                        Grid.Row="1"
                        Margin="0,12,0,4"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="宿主机 IPv4" />

                    <TextBlock
                        Grid.Row="2"
                        FontSize="24"
                        FontWeight="SemiBold"
                        Text="{Binding HostIpAddress}"
                        TextWrapping="Wrap" />
                </Grid>
            </ui:Card>

            <!--  右侧：代理状态卡片  -->
            <ui:Card
                Grid.Row="0"
                Grid.Column="2"
                VerticalAlignment="Stretch">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <StackPanel
                        Grid.Row="0"
                        Orientation="Horizontal">
                        <ui:SymbolIcon
                            FontSize="24"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Symbol="Globe24" />

                        <!--  状态指示灯  -->
                        <Border
                            Width="10"
                            Height="10"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center"
                            CornerRadius="5">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <!--  Default: Grey  -->
                                    <Setter Property="Background" Value="#737373" />
                                    <Style.Triggers>
                                        <DataTrigger
                                            Binding="{Binding IsProxyEnabled}"
                                            Value="True">
                                            <!--  Active: Green  -->
                                            <Setter Property="Background" Value="#00CC6A" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>
                    </StackPanel>

                    <TextBlock
                        Grid.Row="1"
                        Margin="0,12,0,4"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="当前系统代理" />

                    <TextBlock
                        Grid.Row="2"
                        FontSize="24"
                        FontWeight="SemiBold"
                        Text="{Binding CurrentProxyAddress}"
                        TextWrapping="Wrap" />
                </Grid>
            </ui:Card>

            <!--  ===第二行：操作按钮 (Row 2)===  -->
            <!--  左侧：快速设置大按钮 (占据左半边，与上方卡片对齐)  -->
            <ui:Button
                Grid.Row="2"
                Grid.Column="0"
                Height="50"
                HorizontalAlignment="Stretch"
                Appearance="Primary"
                Command="{Binding QuickSetCommand}"
                IsEnabled="{Binding CanQuickSet}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <ui:SymbolIcon
                        Grid.Column="0"
                        FontSize="18"
                        Symbol="Rocket24" />

                    <TextBlock
                        Grid.Column="1"
                        Margin="10,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="14"
                        Text="应用宿主机 IP (7890)" />
                </Grid>
            </ui:Button>

            <!--  右侧：两个小按钮 (嵌套 Grid)  -->
            <!--  在右半边内部再分两列，间距同样设为 16px  -->
            <Grid
                Grid.Row="2"
                Grid.Column="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <!--  内部按钮间距  -->
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  刷新按钮  -->
                <ui:Button
                    Grid.Column="0"
                    Height="50"
                    HorizontalAlignment="Stretch"
                    Appearance="Secondary"
                    Command="{Binding RefreshCommand}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ui:SymbolIcon
                            Grid.Column="0"
                            FontSize="18"
                            Symbol="ArrowCounterclockwise24" />

                        <TextBlock
                            Grid.Column="1"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Text="刷新" />
                    </Grid>
                </ui:Button>

                <!--  禁用按钮  -->
                <ui:Button
                    Grid.Column="2"
                    Height="50"
                    HorizontalAlignment="Stretch"
                    Appearance="Danger"
                    Command="{Binding DisableProxyCommand}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ui:SymbolIcon
                            Grid.Column="0"
                            FontSize="18"
                            Symbol="DismissCircle24" />

                        <TextBlock
                            Grid.Column="1"
                            Margin="8,0,0,0"
                            VerticalAlignment="Center"
                            Text="禁用" />
                    </Grid>
                </ui:Button>
            </Grid>
        </Grid>

        <!--  3. 底部状态栏  -->
        <StatusBar
            Grid.Row="2"
            Padding="12,8"
            Background="Transparent">
            <StatusBarItem>
                <TextBlock
                    FontSize="12"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="{Binding StatusMessage}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</ui:FluentWindow>
